# generated by Ansible.

{% if ansible_fqdn in groups['logstash-shipper'] %}

input {
    beats {
        port => {{ logstash_listen_port_beats }}
        type => beats
    }
}

output {
    rabbitmq {
         host => {{ rabbitmq_hostname }}
         exchange => "t1-raw-log"
         exchange_type => "direct"
         user => {{ rabbitmq_username }}
         password => {{ rabbitmq_password }}
         vhost => {{ rabbitmq_vhost }}
         workers => 1
         durable => {{ rabbitmq_durable }}
         persistent => true
    }
}

{% elif ansible_fqdn in groups['logstash-raw-log'] %}

input {
  rabbitmq {
    host => {{ rabbitmq_hostname }}
    exchange => "t1-raw-log"
    user => {{ rabbitmq_username }}
    password => {{ rabbitmq_password }}
    vhost => {{ rabbitmq_vhost }}
    queue => "t1-raw-log"
    tags  => [ "t1-raw-log" ]
    durable => {{ rabbitmq_durable }}
    ack => {{ rabbitmq_ack }}
    threads => 1
    prefetch_count => 50
    port => {{ rabbitmq_port }}
  }
}

output {
  rabbitmq {
       host => {{ rabbitmq_hostname }}
       exchange => "t2-grok-ready"
       exchange_type => "direct"
       user => {{ rabbitmq_username }}
       password => {{ rabbitmq_password }}
       vhost => {{ rabbitmq_vhost }}
       workers => 1
       durable => {{ rabbitmq_durable }}
       persistent => true
  }
}

{% elif ansible_fqdn in groups['logstash-grok-ready'] %}

input {
  rabbitmq {
    host => {{ rabbitmq_hostname }}
    exchange => "t2-grok-ready"
    user => {{ rabbitmq_username }}
    password => {{ rabbitmq_password }}
    vhost => {{ rabbitmq_vhost }}
    queue => "t2-grok-ready"
    tags  => [ "t2-grok-ready" ]
    durable => {{ rabbitmq_durable }}
    ack => {{ rabbitmq_ack }}
    threads => 1
    prefetch_count => 50
    port => {{ rabbitmq_port }}
  }
}

output {
  rabbitmq {
       host => {{ rabbitmq_hostname }}
       exchange => "t3-grok-complete"
       exchange_type => "direct"
       user => {{ rabbitmq_username }}
       password => {{ rabbitmq_password }}
       vhost => {{ rabbitmq_vhost }}
       workers => 1
       durable => {{ rabbitmq_durable }}
       persistent => true
  }
}

{% elif ansible_fqdn in groups['logstash-grok-complete'] %}

input {
  rabbitmq {
    host => {{ rabbitmq_hostname }}
    exchange => "t3-grok-complete"
    user => {{ rabbitmq_username }}
    password => {{ rabbitmq_password }}
    vhost => {{ rabbitmq_vhost }}
    queue => "t3-grok-complete"
    tags  => [ "t3-grok-complete" ]
    durable => {{ rabbitmq_durable }}
    ack => {{ rabbitmq_ack }}
    threads => 1
    prefetch_count => 50
    port => {{ rabbitmq_port }}
  }
}

output {
  elasticsearch {
    hosts => {{ logstash_elasticsearch_hosts | to_json }}
    index => "[type]-%{+YYYY.MM.dd}"
  }
}

{% endif %}
